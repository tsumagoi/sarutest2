<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸</title>
    <style>
      #map {
        height: 100%;
      }
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #sidebar {
        position: absolute;
        bottom: 10px;
        left: 10px;
        width: 20%;
        height: 40%;
        border: 1px solid #666;
        padding: 6px;
        background-color: white;
        font-family: Meriyo UI;
        font-size: 16x;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <td><div id="sidebar"></div></td>
    <script src="constants.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?language=ja&region=JP&key=AIzaSyAP3rtRtZc0QL5h7nkb7HjTRPfmA_qeSlw&callback=initMap" async defer></script>
    <script>
      var map;
      var marker = [];
      var infoWindow = [];
      var windowOpened;

      function parseData(data) {
        var keys = data.values[0];
        var markerData = [];
        data.values.forEach(function(value, i) {
          if (i > 0) {
            var hash = {};
            value.forEach(function(d, j) {
              hash[keys[j]] = d;
            });
            markerData.push(hash);
          }
        });
        return markerData;
      }

      function initMap() {
        var target = document.getElementById('map');
        var centerp = {lat: 36.516867, lng: 138.530227};

        map = new google.maps.Map(target, {
          center: centerp,
          zoom: 14,
        });

        var request = new XMLHttpRequest();
        request.open('GET', `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/sheet1?key=${API_KEY}`, true);
        request.responseType = 'json';

        request.onload = function () {
          var data = this.response;
          var markerData = parseData(data);
          setData(markerData);
        };

        request.send();
      }




      function addMarker(i, data) {

	      
      var lineSymbol1 = {
      path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
      };
      var line = new google.maps.Polyline({
      path: [{lat: Number(data['ç·¯åº¦4']), lng: Number(data['çµŒåº¦4'])}, 
	     {lat: Number(data['ç·¯åº¦5']), lng: Number(data['çµŒåº¦5'])}],
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€strokeColor: "#FF0000",                
      strokeOpacity: 0.5,
      icons: [{
      icon: lineSymbol1,
      strokeColor: "#FF0000",                
      strokeOpacity: 0.5,
      offset: '50%'
      }],
      map: map
      });


	      
      var lineSymbol2 = {
      path: 'M 0,-1 0,1',
      strokeColor: "#FF0000",                
      strokeOpacity: 0.3,    
      scale: 4
      };
      var line = new google.maps.Polyline({
      path: [{lat: Number(data['ç·¯åº¦6']), lng: Number(data['çµŒåº¦6'])}, 
	     {lat: Number(data['ç·¯åº¦7']), lng: Number(data['çµŒåº¦7'])}],
      strokeOpacity: 0,
      icons: [{               
      icon: lineSymbol2,
      offset: '0',
      repeat: '20px'
      }],
      map: map
      });


	      
      var lineSymbol3 = {
      path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
      strokeColor: "#FF0000",                
      strokeOpacity: 0.3
      };
      var line = new google.maps.Polyline({
      path: [{lat: Number(data['ç·¯åº¦6']), lng: Number(data['çµŒåº¦6'])}, 
	     {lat: Number(data['ç·¯åº¦7']), lng: Number(data['çµŒåº¦7'])}],
      strokeOpacity: 0,
      icons: [{
      icon: lineSymbol3,
      offset: '100%'
      }],
      map: map
      });
	      
	      
        var markerLatLng1 = new google.maps.LatLng({
          lat: Number(data['ç·¯åº¦1']),
          lng: Number(data['çµŒåº¦1'])
        });
        marker[i] = new google.maps.Marker({
          position: markerLatLng1,
          map: map,
	icon: {
		fillColor: "#FF0000",                //å¡—ã‚Šæ½°ã—è‰²
		fillOpacity: 0.8,                    //å¡—ã‚Šæ½°ã—é€éç‡
		path: google.maps.SymbolPath.CIRCLE, //å††ã‚’æŒ‡å®š
		scale: 20,                           //å††ã®ã‚µã‚¤ã‚º
		strokeColor: "#FFFFFF00",              //æ ã®è‰²
		strokeWeight: 0.8                    //æ ã®é€éç‡
	},
	label: {
		text: data['åç§°1'],                           //ãƒ©ãƒ™ãƒ«æ–‡å­—
		color: '#FFFFFF',                    //æ–‡å­—ã®è‰²
		fontSize: '15px'                     //æ–‡å­—ã®ã‚µã‚¤ã‚º
	}
        });
	      
        var markerLatLng2 = new google.maps.LatLng({
          lat: Number(data['ç·¯åº¦2']),
          lng: Number(data['çµŒåº¦2'])
        });
        marker[i] = new google.maps.Marker({
          position: markerLatLng2,
          map: map,
	icon: {
		fillColor: "#FF0000",                //å¡—ã‚Šæ½°ã—è‰²
		fillOpacity: 0.55,                    //å¡—ã‚Šæ½°ã—é€éç‡
		path: google.maps.SymbolPath.CIRCLE, //å††ã‚’æŒ‡å®š
		scale: 20,                           //å††ã®ã‚µã‚¤ã‚º
		strokeColor: "#FFFFFF00",              //æ ã®è‰²
		strokeWeight: 0.3                    //æ ã®é€éç‡
	},
	label: {
		text: data['åç§°2'],                           //ãƒ©ãƒ™ãƒ«æ–‡å­—
		color: '#FFFFFF',                    //æ–‡å­—ã®è‰²
		fontSize: '15px'                     //æ–‡å­—ã®ã‚µã‚¤ã‚º
	}
        });

	      
        var markerLatLng3 = new google.maps.LatLng({
          lat: Number(data['ç·¯åº¦3']),
          lng: Number(data['çµŒåº¦3'])
        });
        marker[i] = new google.maps.Marker({
          position: markerLatLng3,
          map: map,
	icon: {
		fillColor: "#FF0000",                //å¡—ã‚Šæ½°ã—è‰²
		fillOpacity: 0.3,                    //å¡—ã‚Šæ½°ã—é€éç‡
		path: google.maps.SymbolPath.CIRCLE, //å††ã‚’æŒ‡å®š
		scale: 20,                           //å††ã®ã‚µã‚¤ã‚º
		strokeColor: "#FFFFFF00",              //æ ã®è‰²
		strokeWeight: 0.2                    //æ ã®é€éç‡
	},
	label: {
		text: data['åç§°3'],                           //ãƒ©ãƒ™ãƒ«æ–‡å­—
		color: '#FFFFFF',                    //æ–‡å­—ã®è‰²
		fontSize: '15px'                     //æ–‡å­—ã®ã‚µã‚¤ã‚º
	}
        });	      

        var markerLatLng = new google.maps.LatLng({
          lat: Number(data['ç·¯åº¦']),
          lng: Number(data['çµŒåº¦'])
        });
        marker[i] = new google.maps.Marker({
          position: markerLatLng,
          map: map,
	icon: {
		fillColor: "#FFFFFF00",                //å¡—ã‚Šæ½°ã—è‰²
		fillOpacity: 0,                    //å¡—ã‚Šæ½°ã—é€éç‡
		path: google.maps.SymbolPath.CIRCLE, //å††ã‚’æŒ‡å®š
		scale: 20,                           //å††ã®ã‚µã‚¤ã‚º
		strokeColor: "#FFFFFF00",              //æ ã®è‰²
		strokeWeight: 0                    //æ ã®é€éç‡
	}

        });	 


         var info = '<div style="font-size:18px;font-weight:bold;margin-bottom:10px;">' + data['åç§°']  +' / '+ data['æ™‚é–“']+ '</div>';
        infoWindow[i] = new google.maps.InfoWindow({
          content: info
        });

        markerEvent(i);
      }

      function setData(markerData){
        var sidebar_html = "[æ¿ƒğŸ”´]æœ€æ–°ã®ä½ç½® / [è–„ğŸ”´]éå»ã®ä½ç½® / [ãƒ»ãƒ»ãƒ»â†’]ç§»å‹•äºˆæ¸¬";
        for (var i = 0; i < markerData.length; i++) {
          var latitude = markerData[i]['ç·¯åº¦'];
          if (!latitude) { continue; }
          addMarker(i, markerData[i]);
          var name = markerData[i]['åç§°']+[' / ']+markerData[i]['æ™‚é–“'];

          sidebar_html += ` <br /><a href="javascript:openWindow(${i})">${name}<\/a>`;
        }

        document.getElementById("sidebar").innerHTML = sidebar_html;
      }

      function markerEvent(i) {
        marker[i].addListener('click', function() {
          openWindow(i);
        });
      }

      function openWindow(i) {
        if(windowOpened){
          windowOpened.close();
        }
        infoWindow[i].open(map, marker[i]);
        windowOpened = infoWindow[i];
      }
    </script>
  </body>
</html>
